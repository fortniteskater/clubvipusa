<script>
function isPageOnline(file) {
	const status = JSON.parse(localStorage.getItem('vipPageStatus') || '{}');
	return status[file] !== false;
}
if (!isPageOnline('adminpanel.html')) {
	document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;"><span style="font-size:3em;color:#e94560;font-weight:bold;animation:flash 1s infinite;">*OFFLINE*</span></div>';
}
</script>
<style>
@keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
</style>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>VIP Club Admin Panel</title>
	<style>
		body {
			font-family: 'Segoe UI', Arial, sans-serif;
			background: linear-gradient(135deg, #1a1a2e, #16213e 80%);
			color: #fff;
			margin: 0;
			padding: 0;
		}
		.container {
			max-width: 600px;
			margin: 60px auto;
			background: rgba(34, 34, 51, 0.95);
			border-radius: 16px;
			box-shadow: 0 8px 32px rgba(0,0,0,0.3);
			padding: 32px;
		}
		h1 {
			text-align: center;
			font-size: 2.2em;
			margin-bottom: 24px;
			letter-spacing: 2px;
		}
		.section {
			margin-bottom: 32px;
		}
		.file-list {
			margin-top: 16px;
		}
		.file-item {
			margin-bottom: 10px;
		}
		.btn {
			background: #43d8c9;
			color: #fff;
			border: none;
			border-radius: 8px;
			padding: 8px 16px;
			font-size: 1em;
			cursor: pointer;
			margin-left: 8px;
		}
		.btn:hover {
			background: #e94560;
		}
		#chatbox {
			width: 100%;
			height: 180px;
			background: #222233;
			border-radius: 8px;
			padding: 12px;
			overflow-y: auto;
			margin-bottom: 12px;
		}
		.user, .ai {
			margin-bottom: 10px;
		}
		.user {
			color: #43d8c9;
		}
		.ai {
			color: #e94560;
		}
	</style>
</head>
<body>
	<div id="passwordPrompt" class="container">
		<h1>Admin Panel Login</h1>
		<form id="loginForm" style="display:flex; flex-direction:column; align-items:center;">
			<input type="password" id="adminPassword" placeholder="Enter admin password" style="margin-bottom:16px; padding:10px; border-radius:8px; border:none; font-size:1em; width:80%;">
			<button type="submit" class="btn">Login</button>
		</form>
		<div id="loginError" style="color:#e94560; text-align:center; margin-top:16px; display:none;">Incorrect password. Please try again.</div>
	</div>
	<div id="mainContent" style="display:none;">
		<div class="container">
			<h1>VIP Club Admin Panel</h1>
			<div class="section">
				<h2>Customize VIP Club Files</h2>
				<div class="file-list" id="fileList"></div>
				<form id="addFileForm" style="margin-top:16px;">
					<input type="text" id="newFileName" placeholder="New file name (e.g., newpage.html)" required style="padding:8px; border-radius:8px; border:none; font-size:1em;">
					<button type="submit" class="btn">Add File</button>
				</form>
			</div>
			<div class="section">
				<h2>Chat with Copilot</h2>
				<div id="chatbox"></div>
				<form id="chatForm" style="display:flex; justify-content:center;">
					<input type="text" id="userInput" placeholder="Ask Copilot anything..." required style="padding:8px; border-radius:8px; border:none; font-size:1em; width:80%;">
					<button type="submit" class="btn">Send</button>
				</form>
			</div>
		</div>
	</div>
	<script>
	const ADMIN_PASSWORD = "passwordadmin";
		document.getElementById('loginForm').addEventListener('submit', function(e) {
			e.preventDefault();
			const input = document.getElementById('adminPassword').value;
			if (input === ADMIN_PASSWORD) {
				document.getElementById('passwordPrompt').style.display = 'none';
				document.getElementById('mainContent').style.display = 'block';
				renderFiles();
			} else {
				document.getElementById('loginError').style.display = 'block';
			}
		});

		// File management (localStorage demo)
		function getFiles() {
			return JSON.parse(localStorage.getItem('vipAdminFiles') || '[]');
		}
		function saveFiles(files) {
			localStorage.setItem('vipAdminFiles', JSON.stringify(files));
		}
		function renderFiles() {
			const fileList = document.getElementById('fileList');
			let files = getFiles();
			fileList.innerHTML = '';
			if (files.length === 0) {
				fileList.innerHTML = '<div>No custom files added yet.</div>';
			} else {
				files.forEach((file, i) => {
					const div = document.createElement('div');
					div.className = 'file-item';
					div.innerHTML = `${file} <button class='btn' onclick='removeFile(${i})'>Remove</button>`;
					fileList.appendChild(div);
				});
			}
		}
		window.removeFile = function(idx) {
			let files = getFiles();
			files.splice(idx, 1);
			saveFiles(files);
			renderFiles();
		}
		document.getElementById('addFileForm').addEventListener('submit', function(e) {
			e.preventDefault();
			const name = document.getElementById('newFileName').value.trim();
			if (!name) return;
			let files = getFiles();
			files.push(name);
			saveFiles(files);
			renderFiles();
			document.getElementById('newFileName').value = '';
		});

		// Copilot chat (real backend)
		const chatbox = document.getElementById('chatbox');
		const chatForm = document.getElementById('chatForm');
		const userInput = document.getElementById('userInput');
		function appendMessage(sender, message) {
			const div = document.createElement('div');
			div.className = sender;
			div.textContent = (sender === 'user' ? 'You: ' : 'Copilot: ') + message;
			chatbox.appendChild(div);
			chatbox.scrollTop = chatbox.scrollHeight;
		}
		chatForm.addEventListener('submit', async function(e) {
			e.preventDefault();
			const question = userInput.value.trim();
			if (!question) return;
			appendMessage('user', question);
			userInput.value = '';
			appendMessage('ai', 'Thinking...');
			try {
				const res = await fetch('http://localhost:3000/api/chat', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ message: question })
				});
				const data = await res.json();
				chatbox.lastChild.textContent = 'Copilot: ' + (data.reply || data.error);
			} catch (err) {
				chatbox.lastChild.textContent = 'Copilot: Error connecting to server.';
			}
		});
	</script>
</body>
</html>
